{% extends "base/index.html" %}
{% load static  %}
{% block content %}
    <div id="layoutSidenav_content">
        <main>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item active" aria-current="page"><h2>Dashboard</h2></li>
                </ol>
            </nav>
            <div class="container-fluid">
                {% if not new %}
                <div class="card mb-4 text-center">
                    <div class="card-body">
                        SLPNotify will monitor SLP transactions after setting up <a href="{% url 'setuptoken'%}">token id</a> (required) and <a href="{% url 'setupslpaddress'%}">simple ledger address</a> (optional).
                    </div>
                </div>
                {% else %}
                <div class="card mb-4">
                    <div class="card-header text-primary">
                        <div class="d-flex flex-row-reverse">
                        <div class="row">
                            <form class="form-inline">
                                <div class="form-group mb-2">
                                    <select class="form-control" id="first-choice">
                                        {% for token in tokens%}
                                            {% if token.tokenid == querytoken %}
                                                <option selected value="{{ token.tokenid }}">{{ token.name }}</option>
                                            {% else %}
                                                <option value="{{ token.tokenid }}">{{ token.name }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="form-group mx-sm-3 mb-2">
                                    <select class="form-control" id="second-choice">
                                        {% for slp in slpaddresses %}
                                            {% if slp.id == queryslpaddress %}
                                                <option selected value="{{ slp.id }}">{{ slp.address }}</option>
                                            {% else %}
                                                <option value="{{ slp.id }}">{{ slp.address }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                            </form>
                        </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th>Transaction ID</th>
                                        <th>Amount</th>
                                        <th>Block</th>
                                    </tr>
                                </thead>
                                <tfoot>
                                    <tr>
                                        <th>Transaction ID</th>
                                        <th>Amount</th>
                                        <th>Block</th>
                                    </tr>
                                </tfoot>
                                <tbody>
                                    {% for trans in transactions %}
                                        <tr>
                                            <td>{{ trans.txid }}</td>
                                            <td>{{ trans.amount }}</td>
                                            <td>{{ trans.blockheight__number }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </main>
        <footer class="py-4 bg-light mt-auto">
            <div class="container-fluid">
                <div class="d-flex align-items-center justify-content-between small">
                    <div class="text-muted">Copyright &copy; SPICE 2020</div>
                    <div>
                        <a href="#">Privacy Policy</a>
                        &middot;
                        <a href="#">Terms &amp; Conditions</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    <script>
        function updateQueryStringParameter(uri, key, value) {
            var re = new RegExp("([?&])" + key + "=.*?(&|$)", "i");
            var separator = uri.indexOf('?') !== -1 ? "&" : "?";
            if (uri.match(re)) {
                return uri.replace(re, '$1' + key + "=" + value + '$2');
            }
            else {
                return uri + separator + key + "=" + value;
            }
        }

        $("#first-choice").change(function() {
            var e = document.getElementById("first-choice");
            var id = e.options[e.selectedIndex].value;
            var url = updateQueryStringParameter(window.location.href, 'token', id)
            window.location = url;
        });
        
        $("#second-choice").change(function() {
            var e = document.getElementById("second-choice");
            var id = e.options[e.selectedIndex].value;
            // window.location = window.location.href +'&slp=' + id;
            var url = updateQueryStringParameter(window.location.href, 'slp', id)
            window.location = url;
        });
    </script>
{% endblock content %}